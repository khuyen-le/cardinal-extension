"0","df.trial <- df.raw_exp2 %>% "
"0","  select(id, age_months, age_years, "
"0","         stim_set, highest_count, knower_level, knower_level_cp_subset,"
"0","         trial, set_chosen, count, n_item1, n_item2, set_correct, is_filler) %>%"
"0","  mutate(count = as.numeric(count), "
"0","         is_filler = ifelse(is_filler == ""Y"", ""filler"", ""trial""), "
"0","         correct_n_items = ifelse(n_item1 > n_item2, n_item1, n_item2)) %>%"
"0","   mutate(trial_type = case_when("
"0","            n_item1 <= 4 ~ ""small"", "
"0","            n_item1 >= 5 & (n_item1 / n_item2 >= 2 | n_item2 / n_item1 >= 2) ~ ""large - DR"","
"0","            n_item1 >= 5 & (n_item1 / n_item2 < 2 | n_item2 / n_item1 < 2) ~ ""large - NDR"","
"0","          )) %>%"
"0","  mutate(magnitude = case_when("
"0","            n_item1 <= 4 ~ ""small"", "
"0","            n_item1 >= 5 ~ ""large"","
"0","          )) %>%"
"0","  # if the trial is a filler, then these fields should be NA"
"0","  mutate(correct_n_items = ifelse(is_filler == ""trial"", correct_n_items, NA), "
"0","         trial_type = ifelse(is_filler == ""trial"", trial_type, NA)) %>%"
"0","  rowwise() %>%"
"0","  mutate(trial_ratio = paste(sort(c(n_item1, n_item2)), collapse = ""-"")) %>%"
"0","  mutate(correct_set_chosen = case_when("
"0","          set_chosen == set_correct & is_filler == ""trial"" ~ 1, "
"0","          set_chosen != set_correct & is_filler == ""trial"" ~ 0,"
"0","          is.na(set_chosen) ~ 0,"
"0","          is_filler == ""filler"" ~ 0,"
"0","        ),"
"0","         correct_count = case_when( #N/A means did not count"
"0","           is.na(count) ~ 0,"
"0","           is_filler == ""filler"" ~ 0,"
"0","           count == correct_n_items & is_filler == ""trial"" ~ 1,"
"0","           count != correct_n_items & is_filler == ""trial"" ~ 0"
"0","         ), "
"0","        correct_set_chosen_with_correct_count = ifelse("
"0","           correct_count == 1 | correct_set_chosen == 1, 1, 0"
"0","         ),"
"0","         count_error = case_when("
"0","          !is.na(count) & is_filler == ""trial"" ~ count - correct_n_items,"
"0","         ), "
"0","         correct_count_approx = case_when( # not correct for non-distinguishable ratios"
"0","           is.na(count) ~ 0,"
"0","           count_error >= -1 & count_error <= 1 & is_filler == ""trial"" ~ 1, "
"0","           count_error < -1 | count_error > 1 & is_filler == ""trial"" ~ 0"
"0","         )) "
"0",""
"0","df.trial <- df.trial %>%"
"0","  filter(is_filler != ""filler"")"
"0",""
"0","write.csv(df.trial, ""../../../data/pilot/PROCESSED_DATA/pilot_exp2_trial.csv"", row.names = FALSE)"
